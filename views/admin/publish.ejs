<!DOCTYPE html>
<html lang="es">
<head>
    <%- include('../partials/head') %>
    <link rel="stylesheet" href="/css/publish.css">
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <style>
        /* Hacemos que la columna derecha destaque visualmente */
        .col-side .panel-card {
            background-color: #ffffff;
            border: 1px solid #94a3b8; /* Borde m√°s oscuro */
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1); /* Sombra profunda */
            position: relative;
            overflow: hidden;
        }
        
        /* Barra de acento superior para las tarjetas de la derecha */
        .col-side .panel-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, #2563eb, #3b82f6);
        }

        .col-side .panel-title {
            color: #0f172a;
            font-weight: 800;
            letter-spacing: -0.02em;
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        /* Resaltar Precio */
        .highlight-card {
            background-color: #f8fafc !important; /* Fondo sutilmente gris/azulado */
        }
        /* --- CORRECCI√ìN DE LAYOUT Y SIDEBAR --- */
        
        /* 1. Asegura que el contenedor principal use Flexbox */
        .app-layout {
            display: flex;
            min-height: 100vh; /* Ocupa al menos el 100% de la pantalla */
            width: 100%;
            overflow-x: hidden;
        }

        /* 2. Corrige el Sidebar para que sea Sticky (se queda fijo al bajar) */
        aside.sidebar {
            width: 280px; /* Mismo ancho que tu variable --sb-width */
            height: 100vh; /* Altura completa de la ventana */
            position: sticky; /* Se pega al borde superior */
            top: 0;
            left: 0;
            flex-shrink: 0; /* Evita que se encoja */
            overflow-y: auto; /* Permite scroll interno si el men√∫ es muy alto */
            z-index: 1000;
            background: #ffffff; /* Asegura fondo blanco */
            border-right: 1px solid #e2e8f0;
        }

        /* 3. Ajusta el contenido principal para que fluya a la derecha */
        .main-content {
            flex: 1; /* Toma el espacio restante */
            width: calc(100% - 280px); /* Resta el ancho del sidebar */
            min-height: 100vh;
            background-color: #f8fafc; /* Color de fondo general */
            display: block; /* Asegura flujo normal */
        }

        /* 4. Ajuste espec√≠fico para el wrapper de publicar */
        .publish-wrapper-fluid {
            padding: 2rem;
            max-width: 1600px;
            margin: 0 auto;
        }
    </style>

    <script>
        // --- 1. CONFIG MAPA Y GEOCODING INTELIGENTE ---
        let map, marker, circle, autocomplete, geocoder;
        let searchTimeout = null;

        window.initMap = function() {
            const defaultPos = { lat: -33.4489, lng: -70.6693 };
            const mapElement = document.getElementById("googleMap");
            if (!mapElement) return;

            geocoder = new google.maps.Geocoder();

            map = new google.maps.Map(mapElement, {
                center: defaultPos,
                zoom: 13,
                mapTypeControl: false,
                streetViewControl: false,
                fullscreenControl: true,
                styles: [{featureType:"poi",stylers:[{visibility:"off"}]}]
            });

            marker = new google.maps.Marker({
                position: defaultPos,
                map: map,
                draggable: true,
                animation: google.maps.Animation.DROP,
                visible: true 
            });

            circle = new google.maps.Circle({
                map: map, radius: 300, fillColor: '#2563EB', fillOpacity: 0.2,
                strokeColor: '#2563EB', strokeOpacity: 0.4, strokeWeight: 1, visible: false 
            });
            circle.bindTo('center', marker, 'position');

            const input = document.getElementById("addressInput");
            autocomplete = new google.maps.places.Autocomplete(input, {
                componentRestrictions: { country: "cl" },
                fields: ["address_components", "geometry"],
                types: ["address"]
            });
            autocomplete.bindTo("bounds", map);

            autocomplete.addListener("place_changed", () => {
                const place = autocomplete.getPlace();
                if (!place.geometry) { showToast('error', 'Direcci√≥n no encontrada'); return; }
                updateMapPosition(place.geometry.location);
                fillAddressFields(place.address_components); 
            });

            marker.addListener("dragend", () => {
                const pos = marker.getPosition();
                updateCoordinates(pos);
                geocodePosition(pos);
            });

            map.addListener("click", (e) => {
                marker.setPosition(e.latLng);
                updateCoordinates(e.latLng);
                geocodePosition(e.latLng);
            });

            document.getElementById('privacyCheck').addEventListener('change', function() {
                const isPrivate = this.checked;
                circle.setVisible(isPrivate);
                marker.setVisible(!isPrivate); 
                map.setZoom(isPrivate ? 14 : 17);
            });
        };

        function updateMapPosition(location) {
            if (location.viewport) map.fitBounds(location.viewport);
            else { map.setCenter(location); map.setZoom(17); }
            marker.setPosition(location);
            updateCoordinates(location);
        }

        function geocodePosition(pos) {
            geocoder.geocode({ location: pos }, (results, status) => {
                if (status === "OK" && results[0]) {
                    fillAddressFields(results[0].address_components);
                    const street = document.getElementById('route').value;
                    const comm = document.getElementById('locality').value;
                    const display = street ? `${street}, ${comm}` : results[0].formatted_address.split(',')[0];
                    document.getElementById('addressInput').value = display;
                    document.getElementById('displayAddress').value = display;
                }
            });
        }

        function handleCoordsInput(input) {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const val = input.value;
                if(val.includes(',') && val.match(/-?\d+\.\d+/)) {
                    searchByCoords();
                }
            }, 500); 
        }

        function searchByCoords() {
            const input = document.getElementById('coordsInput').value;
            const parts = input.split(',');
            if(parts.length === 2) {
                const lat = parseFloat(parts[0].trim());
                const lng = parseFloat(parts[1].trim());
                if(!isNaN(lat) && !isNaN(lng)) {
                    const pos = new google.maps.LatLng(lat, lng);
                    updateMapPosition(pos);
                    geocodePosition(pos);
                    showToast('success', 'üìç Coordenadas detectadas');
                }
            }
        }

        function fillAddressFields(components) {
            document.getElementById('route').value = '';
            document.getElementById('street_number').value = '';
            document.getElementById('locality').value = '';
            document.getElementById('region').value = '';

            components.forEach(c => {
                const t = c.types;
                if(t.includes('route')) {
                    if(!c.long_name.includes('+')) document.getElementById('route').value = c.long_name;
                }
                if(t.includes('street_number')) document.getElementById('street_number').value = c.long_name;
                if(t.includes('locality') || t.includes('administrative_area_level_3')) 
                    document.getElementById('locality').value = c.long_name;
                if(t.includes('administrative_area_level_1')) document.getElementById('region').value = c.long_name;
            });
            
            const numField = document.getElementById('street_number');
            if(!numField.value) numField.value = 'S/N';

            const routeField = document.getElementById('route');
            if(!routeField.value) {
                const comm = document.getElementById('locality').value;
                if(comm) routeField.value = 'Sector ' + comm;
                else routeField.value = 'Ubicaci√≥n Rural';
            }
            
            const calle = routeField.value;
            if(calle) document.getElementById('displayAddress').value = calle;
        }

        function updateCoordinates(latLng) {
            document.getElementById('lat').value = latLng.lat();
            document.getElementById('lng').value = latLng.lng();
            document.getElementById('coordsInput').value = `${latLng.lat().toFixed(6)}, ${latLng.lng().toFixed(6)}`;
        }

        function showToast(icon, title) {
            Swal.fire({
                toast: true, position: 'bottom-end', icon: icon, title: title,
                showConfirmButton: false, timer: 3000, timerProgressBar: true,
                customClass: { popup: 'modern-toast' }
            });
        }
    </script>
</head>
<body>
    <div class="app-layout">
        <%- include('../partials/sidebar-admin') %>

        <main class="main-content">
            <div class="publish-wrapper-fluid">
                
                <div class="header-actions-bar">
                    <div class="header-title">
                        <h1><i class="ph-duotone ph-house-line"></i> Nueva Propiedad</h1>
                        <% if(indicators && indicators.uf) { %>
                            <span class="uf-badge">UF Hoy: $<%= parseInt(indicators.uf).toLocaleString('es-CL') %></span>
                        <% } else { %>
                            <span class="uf-badge" style="background:#fef2f2; color:#ef4444; border-color:#fecaca;">UF No disponible</span>
                        <% } %>
                    </div>
                    <div class="actions-group">
                        <button type="button" class="btn-ghost" onclick="history.back()">Cancelar</button>
                        <button type="button" class="btn-primary-glow" onclick="validateAndSubmit()">
                            Publicar Ahora <i class="ph-bold ph-rocket-launch"></i>
                        </button>
                    </div>
                </div>

                <form id="publishForm" enctype="multipart/form-data" novalidate>
                    <div class="publish-grid">
                        
                        <div class="col-main">
                            
                            <div class="panel-card animated-entry">
                                <h3 class="panel-title"><i class="ph-duotone ph-tag"></i> Definici√≥n</h3>
                                <div class="grid-2">
                                    <div class="form-group">
                                        <label>Operaci√≥n <span class="req">*</span></label>
                                        <div class="segment-control-modern">
                                            <input type="radio" name="operacion" id="op_venta" value="Venta" checked>
                                            <label for="op_venta"><i class="ph-bold ph-currency-dollar"></i> Venta</label>
                                            <input type="radio" name="operacion" id="op_arriendo" value="Arriendo">
                                            <label for="op_arriendo"><i class="ph-bold ph-key"></i> Arriendo</label>
                                            <input type="radio" name="operacion" id="op_temp" value="Temporal">
                                            <label for="op_temp"><i class="ph-bold ph-calendar"></i> Temporal</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Categor√≠a <span class="req">*</span></label>
                                        <div class="custom-select-wrapper">
                                            <select name="categoria" id="catSelector" class="input-modern" onchange="toggleFeatures(this.value)" required>
                                                <option value="" disabled selected>Selecciona tipo...</option>
                                                <option value="Casa">üè° Casa</option>
                                                <option value="Departamento">üè¢ Departamento</option>
                                                <option value="Oficina">üíº Oficina</option>
                                                <option value="Terreno">üó∫Ô∏è Terreno / Sitio</option>
                                                <option value="Industrial">üè≠ Industrial / Galp√≥n</option>
                                                <option value="Parcela">üå≤ Parcela / Agr√≠cola</option>
                                                <option value="Local">üè™ Local Comercial</option>
                                            </select>
                                            <i class="ph-bold ph-caret-down select-arrow"></i>
                                        </div>
                                        <div class="error-msg">Selecciona una categor√≠a</div>
                                    </div>
                                </div>
                            </div>

                            <div class="panel-card animated-entry" style="animation-delay: 0.1s;">
                                <div class="panel-header-flex">
                                    <h3 class="panel-title"><i class="ph-duotone ph-map-pin"></i> Ubicaci√≥n</h3>
                                    <label class="privacy-switch">
                                        <input type="checkbox" name="ocultar_mapa" id="privacyCheck">
                                        <span class="slider-round"></span>
                                        <span class="switch-text">Ubicaci√≥n Privada (Ocultar Pin)</span>
                                    </label>
                                </div>

                                <div class="map-search-row" style="display: flex; gap: 10px; margin-bottom: 15px;">
                                    <div class="map-search-container" style="flex: 2;">
                                        <i class="ph-bold ph-magnifying-glass search-icon"></i>
                                        <input type="text" id="addressInput" class="map-search-input" placeholder="Buscar direcci√≥n (Calle, Comuna)..." autocomplete="off">
                                    </div>
                                    <div class="map-search-container" style="flex: 1;">
                                        <i class="ph-bold ph-crosshair search-icon"></i>
                                        <input type="text" id="coordsInput" class="map-search-input" placeholder="Pegar Lat, Lng aqu√≠..." oninput="handleCoordsInput(this)">
                                    </div>
                                </div>

                                <div id="googleMap" class="map-frame"></div>

                                <div class="address-fields-grid mt-4">
                                    <div class="form-group span-2">
                                        <label>Calle (Auto)</label>
                                        <input type="text" name="calle" id="route" class="input-modern bg-read" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label>N√∫mero <span class="req">*</span></label>
                                        <input type="text" name="numero" id="street_number" class="input-modern" required>
                                        <div class="error-msg">Requerido (S/N si no tiene)</div>
                                    </div>
                                    <div class="form-group">
                                        <label>Dpto/Of</label>
                                        <input type="text" name="unidad" class="input-modern" placeholder="Ej: 402">
                                    </div>
                                    <div class="form-group">
                                        <label>Comuna (Auto)</label>
                                        <input type="text" name="comuna" id="locality" class="input-modern bg-read" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label>Regi√≥n (Auto)</label>
                                        <input type="text" name="region" id="region" class="input-modern bg-read" readonly>
                                    </div>
                                </div>
                                <input type="hidden" name="lat" id="lat">
                                <input type="hidden" name="lng" id="lng">
                                <input type="hidden" name="direccion_display" id="displayAddress">
                            </div>

                            <div class="panel-card animated-entry" style="animation-delay: 0.2s;">
                                <h3 class="panel-title"><i class="ph-duotone ph-list-checks"></i> Detalles y Caracter√≠sticas</h3>
                                
                                <div id="dynamic-features-container">
                                    <div class="feature-section" id="sec-interior">
                                        <h4 class="sub-section-title">Interior & Terminaciones</h4>
                                        <div class="features-grid-dense">
                                            <label class="feature-check"><input type="checkbox" name="f_amoblado"><span>Amoblado</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_hall"><span>Hall Acceso</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_living_sep"><span>Living Sep.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_cocina_americana"><span>Cocina Amer.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_cocina_amob"><span>Cocina Amobl.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_cocina_equip"><span>Cocina Equip.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_granito"><span>Cub. Granito</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_silestone"><span>Cub. Silestone</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_comedor_diario"><span>Comedor Diario</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_loggia"><span>Loggia</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_despensa"><span>Despensa</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_escritorio"><span>Escritorio</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_sala_estar"><span>Sala Estar</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_home_cinema"><span>Home Cinema</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_bar"><span>Bar</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_walkin"><span>Walk-in Closet</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_closet_ropa"><span>Closet Blanca</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_jacuzzi"><span>Jacuzzi</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_chimenea"><span>Chimenea</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_bosca"><span>Bosca</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_aire"><span>Aire Acond.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_calefaccion"><span>Calefacci√≥n</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_losa"><span>Losa Radiante</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_radiadores"><span>Radiadores</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_termopanel"><span>Termopanel</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_ventanas_pvc"><span>Ventanas PVC</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_ventanas_alu"><span>Ventanas Alu.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_alarma"><span>Alarma Int.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_citofono"><span>Cit√≥fono</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_domotica"><span>Dom√≥tica</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_cerradura_dig"><span>Cerradura Digital</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_mansarda"><span>Mansarda</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_subterraneo"><span>Subterr√°neo</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_pieza_serv"><span>Pieza Servicio</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_bano_visita"><span>Ba√±o Visita</span></label>
                                        </div>
                                        
                                        <h4 class="sub-section-title mt-3">Pisos</h4>
                                        <div class="features-grid-dense">
                                            <label class="feature-check"><input type="checkbox" name="f_pisos_madera"><span>Madera</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_pisos_flotante"><span>Flotante</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_pisos_porcelanato"><span>Porcelanato</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_pisos_alfombra"><span>Alfombra</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_pisos_ceramica"><span>Cer√°mica</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_pisos_marmol"><span>M√°rmol</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_pisos_parquet"><span>Parquet</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_pisos_vinilico"><span>Vin√≠lico</span></label>
                                        </div>
                                    </div>

                                    <div class="feature-section" id="sec-exterior">
                                        <h4 class="sub-section-title">Exterior & Entorno Privado</h4>
                                        <div class="features-grid-dense">
                                            <label class="feature-check"><input type="checkbox" name="f_terraza"><span>Terraza</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_terraza_tech"><span>Terraza Tech.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_quincho"><span>Quincho</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_fogion"><span>Fog√≥n</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_piscina"><span>Piscina</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_piscina_temp"><span>Piscina Temp.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_jardin"><span>Jard√≠n</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_riego"><span>Riego Auto.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_antejardin"><span>Antejard√≠n</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_patio_serv"><span>Patio Servicio</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_bodega_jardin"><span>Bodega Jard√≠n</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_canil"><span>Canil</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_porton"><span>Port√≥n Auto.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_cerco"><span>Cerco El√©ct.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_estac_techado"><span>Estac. Techado</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_estac_visitas"><span>Estac. Visitas</span></label>
                                        </div>
                                    </div>

                                    <div class="feature-section" id="sec-comunidad">
                                        <h4 class="sub-section-title">Seguridad & Condominio</h4>
                                        <div class="features-grid-dense">
                                            <label class="feature-check"><input type="checkbox" name="f_condominio"><span>Condominio</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_acceso"><span>Acceso Control</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_conserje_247"><span>Conserje 24/7</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_conserje_diurno"><span>Conserje Diurno</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_conserje_nocturno"><span>Conserje Noct.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_mayordomo"><span>Mayordomo</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_rondas"><span>Rondas</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_biometrico"><span>Biom√©trico</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_cctv"><span>CCTV IP</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_movil"><span>M√≥vil Seguridad</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_cerco_perim"><span>Cerco Perimetral</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_alarma_com"><span>Alarma Comunitaria</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_citofonia_port"><span>Citofon√≠a Porter√≠a</span></label>
                                        </div>

                                        <h4 class="sub-section-title mt-3">Deportes & Recreaci√≥n</h4>
                                        <div class="features-grid-dense">
                                            <label class="feature-check"><input type="checkbox" name="f_club_house"><span>Club House</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_gym"><span>Gimnasio</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_piscina_comun"><span>Piscina Com√∫n</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_tenis"><span>Cancha Tenis</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_padel"><span>Cancha Padel</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_futbol"><span>Cancha F√∫tbol</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_multicancha"><span>Multicancha</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_golf"><span>Cancha Golf</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_squash"><span>Squash</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_sauna"><span>Sauna</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_spa"><span>Spa</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_areas_verdes"><span>√Åreas Verdes</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_juegos"><span>Juegos Ni√±os</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_bicicletero"><span>Bicicletero</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_marina"><span>Marina/Muelle</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_acceso_playa"><span>Acceso Playa</span></label>
                                        </div>

                                        <h4 class="sub-section-title mt-3">Amenities & Servicios</h4>
                                        <div class="features-grid-dense">
                                            <label class="feature-check"><input type="checkbox" name="f_ascensor"><span>Ascensor</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_eventos"><span>Sala Eventos</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_gourmet"><span>Sala Gourmet</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_cine"><span>Sala Cine</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_cowork"><span>Cowork</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_business"><span>Business Center</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_lavanderia"><span>Lavander√≠a</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_electrogeno"><span>Grupo Electr√≥geno</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_paneles"><span>Paneles Solares</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_carga_auto"><span>Carga Auto Elec.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_reciclaje"><span>Punto Reciclaje</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_estac_visitas_com"><span>Estac. Visitas</span></label>
                                        </div>
                                    </div>

                                    <div class="feature-section hidden" id="sec-industrial">
                                        <h4 class="sub-section-title">Industrial & Comercial</h4>
                                        <div class="features-grid-dense">
                                            <label class="feature-check"><input type="checkbox" name="f_trifasica"><span>Trif√°sica</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_monofasica"><span>Monof√°sica</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_generador_ind"><span>Generador Ind.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_red_incendio"><span>Red Incendio</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_sprinklers"><span>Sprinklers</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_anden"><span>And√©n Carga</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_rampa"><span>Rampa</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_entrada_camiones"><span>Entrada Camiones</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_acceso_camiones"><span>Control Camiones</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_grua"><span>Puente Gr√∫a</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_galpon"><span>Galp√≥n</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_piso_tonelaje"><span>Piso Alto Tonelaje</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_oficinas_ind"><span>Oficinas Planta</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_casino"><span>Casino Personal</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_camarines"><span>Camarines</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_altura_6m"><span>Altura > 6m</span></label>
                                        </div>
                                    </div>

                                    <div class="feature-section hidden" id="sec-agricola">
                                        <h4 class="sub-section-title">Legal & Urbanizaci√≥n</h4>
                                        <div class="features-grid-dense">
                                            <label class="feature-check"><input type="checkbox" name="f_rol_propio"><span>Rol Propio</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_acciones_derechos"><span>Acciones/Derechos</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_subdivision"><span>Subdiv. Aprobada</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_recepcion_final"><span>Recepci√≥n Final</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_fact_luz"><span>Factib. El√©ctrica</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_luz_red"><span>Luz de Red (Poste)</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_fact_agua"><span>Factib. Agua</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_apr"><span>Agua Potable (APR)</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_fibra"><span>Factib. Fibra √ìptica</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_senal_4g"><span>Se√±al Celular 4G/5G</span></label>
                                        </div>

                                        <h4 class="sub-section-title mt-3">Agua & Riego</h4>
                                        <div class="features-grid-dense">
                                            <label class="feature-check"><input type="checkbox" name="f_derechos_agua"><span>Derechos Agua Insc.</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_acciones_canal"><span>Acciones Canal</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_pozo"><span>Pozo Profundo</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_noria"><span>Noria</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_vertiente"><span>Vertiente</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_orilla_rio"><span>Orilla R√≠o/Estero</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_orilla_lago"><span>Orilla Lago</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_estanque"><span>Estanque Acumulaci√≥n</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_sala_bombas"><span>Sala Bombas</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_riego_tec"><span>Riego Tecnificado</span></label>
                                        </div>

                                        <h4 class="sub-section-title mt-3">Terreno & Entorno</h4>
                                        <div class="features-grid-dense">
                                            <label class="feature-check"><input type="checkbox" name="f_topo_plana"><span>Topograf√≠a Plana</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_topo_pendiente"><span>Con Pendiente/Loma</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_camino_asfaltado"><span>Acceso Asfaltado</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_camino_tierra"><span>Camino Tierra/Ripio</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_camino_servidumbre"><span>Servidumbre Paso</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_cercado"><span>Cercado Completo</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_porton_acceso"><span>Port√≥n Acceso</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_bosque_nativo"><span>Bosque Nativo</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_eucaliptus"><span>Plant. Eucaliptus</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_pinos"><span>Plant. Pinos</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_frutales"><span>√Årboles Frutales</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_apto_cultivo"><span>Apto Cultivo</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_vista_volcan"><span>Vista Volc√°n</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_vista_valle"><span>Vista Valle</span></label>
                                            <label class="feature-check"><input type="checkbox" name="f_casa_cuidador"><span>Casa Cuidador</span></label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="panel-card animated-entry" style="animation-delay: 0.3s;">
                                <h3 class="panel-title"><i class="ph-duotone ph-article"></i> Descripci√≥n</h3>
                                <div class="form-group mb-4">
                                    <label>T√≠tulo del Aviso <span class="req">*</span></label>
                                    <input type="text" name="titulo" class="input-modern input-lg font-bold" placeholder="Ej: üè° Espectacular Casa en Condominio..." required>
                                    <div class="error-msg">Ingresa un t√≠tulo</div>
                                </div>
                                <div class="form-group">
                                    <label>Descripci√≥n Detallada</label>
                                    <div id="quill-editor" class="quill-modern"></div>
                                    <input type="hidden" name="descripcion" id="hiddenDesc">
                                </div>
                            </div>

                            <div class="panel-card animated-entry" style="animation-delay: 0.4s;">
                                <h3 class="panel-title"><i class="ph-duotone ph-images"></i> Galer√≠a de Fotos</h3>
                                <div class="upload-zone-wide" id="dropZone">
                                    <div class="upload-content">
                                        <i class="ph-duotone ph-cloud-arrow-up icon-upload"></i>
                                        <div>
                                            <strong>Arrastra tus fotos aqu√≠</strong>
                                            <p>o haz click para examinar. La primera ser√° la portada.</p>
                                        </div>
                                    </div>
                                    <input type="file" id="fileInput" multiple accept="image/*" hidden>
                                </div>
                                <div class="gallery-wide-grid" id="galleryPreview"></div>
                            </div>

                        </div>

                        <div class="col-side">
                            
                            <div class="panel-card highlight-card animated-entry">
                                <h3 class="panel-title">Valor Comercial</h3>
                                
                                <div class="currency-pills">
                                    <label><input type="radio" name="moneda" value="UF" checked onchange="setCurrencyMode('UF')"><span>UF</span></label>
                                    <label><input type="radio" name="moneda" value="CLP" onchange="setCurrencyMode('CLP')"><span>Pesos ($)</span></label>
                                    <label><input type="radio" name="moneda" value="USD" onchange="setCurrencyMode('USD')"><span>USD</span></label>
                                </div>

                                <div class="form-group mb-2">
                                    <label>Precio <span class="req">*</span></label>
                                    <div class="input-prefix-wrapper">
                                        <span id="pricePrefix" class="prefix-badge">UF</span>
                                        <input type="text" name="precio" id="priceInput" class="input-modern input-price" placeholder="0" onkeyup="calcPrice()" required autocomplete="off">
                                    </div>
                                    <div class="error-msg">Falta precio</div>
                                </div>

                                <div class="conversion-glass">
                                    <div class="conv-row">
                                        <span class="label">Conversi√≥n:</span>
                                        <span class="value" id="convertedPrice">$ 0</span>
                                    </div>
                                    <% if(indicators && indicators.uf) { %>
                                        <div class="conv-tiny">Calculado con UF: $<%= parseInt(indicators.uf).toLocaleString('es-CL') %></div>
                                    <% } else { %>
                                        <div class="conv-tiny">‚ö†Ô∏è Sin valor UF referencial</div>
                                    <% } %>
                                </div>

                                <div class="divider"></div>

                                <div class="form-group">
                                    <label>Gastos Comunes</label>
                                    <div class="input-prefix-wrapper">
                                        <span class="prefix-badge is-light">$</span>
                                        <input type="text" name="gastos_comunes" class="input-modern pl-50" onkeyup="formatNum(this)">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Contribuciones</label>
                                    <div class="input-prefix-wrapper">
                                        <span class="prefix-badge is-light">$</span>
                                        <input type="text" name="contribuciones" class="input-modern pl-50" onkeyup="formatNum(this)">
                                    </div>
                                </div>
                            </div>

                            <div class="panel-card animated-entry">
                                <h3 class="panel-title">Superficie (m¬≤)</h3>
                                <div class="grid-2-sm">
                                    <div class="form-group"><label>√ötil</label><input type="number" name="m2_util" class="input-modern"></div>
                                    <div class="form-group"><label>Total</label><input type="number" name="m2_total" class="input-modern"></div>
                                    <div class="form-group span-2"><label>Terraza</label><input type="number" name="m2_terraza" class="input-modern"></div>
                                </div>
                            </div>

                            <div class="panel-card animated-entry" id="program-card">
                                <h3 class="panel-title">Ficha T√©cnica</h3>
                                
                                <div class="grid-2-sm mb-3">
                                    <div class="form-group"><label>Dorms</label><input type="number" name="dormitorios" class="input-modern"></div>
                                    <div class="form-group"><label>Ba√±os</label><input type="number" name="banos" class="input-modern"></div>
                                    <div class="form-group"><label>Estac.</label><input type="number" name="estacionamientos" class="input-modern"></div>
                                    <div class="form-group"><label>Bodegas</label><input type="number" name="bodegas" class="input-modern"></div>
                                </div>

                                <div class="form-group">
                                    <label>Estado Propiedad</label>
                                    <div class="custom-select-wrapper">
                                        <select name="condicion" class="input-modern">
                                            <option value="Usada - Buen Estado" selected>Usada - Buen Estado</option>
                                            <option value="Usada - Excelente">Usada - Excelente</option>
                                            <option value="Nueva - Entrega Inmediata">Nueva/Entrega Inmediata</option>
                                            <option value="En Verde">En Verde</option>
                                            <option value="En Blanco (Planos)">En Blanco (Planos)</option>
                                            <option value="Remodelada">Remodelada</option>
                                            <option value="Para Remodelar">Para Remodelar (Inversi√≥n)</option>
                                        </select>
                                        <i class="ph-bold ph-caret-down select-arrow"></i>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Orientaci√≥n</label>
                                    <div class="custom-select-wrapper">
                                        <select name="orientacion" class="input-modern">
                                            <option value="">No definida</option>
                                            <option value="Norte">Norte</option>
                                            <option value="Nor-Oriente">Nor-Oriente</option>
                                            <option value="Oriente">Oriente (Este)</option>
                                            <option value="Sur-Oriente">Sur-Oriente</option>
                                            <option value="Sur">Sur</option>
                                            <option value="Sur-Poniente">Sur-Poniente</option>
                                            <option value="Poniente">Poniente (Oeste)</option>
                                            <option value="Nor-Poniente">Nor-Poniente</option>
                                        </select>
                                        <i class="ph-bold ph-caret-down select-arrow"></i>
                                    </div>
                                </div>

                                <div class="form-group mt-2">
                                    <label>Antig√ºedad (A√±os)</label>
                                    <input type="number" name="antiguedad" class="input-modern" placeholder="0">
                                </div>
                            </div>

                        </div>
                    </div>
                </form>
                <div style="height: 120px;"></div>
            </div>
        </main>
    </div>

    <script>
        const UF_VALUE = <%= indicators && indicators.uf ? indicators.uf : 0 %>;
        const USD_VALUE = <%= indicators && indicators.usd ? indicators.usd : 0 %>;
        
        const uploadedFiles = [];
        let currentCurrency = 'UF';

        // 1. QUILL
        function emojiHandler() {
            Swal.fire({
                title: 'Emojis ‚ú®',
                text: 'Usa "Win + ." (Windows) o "Ctrl + Cmd + Espacio" (Mac) para abrir el teclado.',
                icon: 'info',
                confirmButtonText: 'OK',
                customClass: { popup: 'swal-modern' }
            });
        }
        var quill = new Quill('#quill-editor', {
            theme: 'snow',
            placeholder: 'Descripci√≥n detallada...',
            modules: {
                toolbar: {
                    container: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{ 'color': [] }, { 'background': [] }], 
                        [{ 'script': 'sub'}, { 'script': 'super' }], 
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        [{ 'align': [] }],
                        ['clean'],
                        ['emoji']
                    ],
                    handlers: { 'emoji': emojiHandler }
                }
            }
        });
        const emojiBtn = document.querySelector('.ql-emoji');
        if(emojiBtn) emojiBtn.innerHTML = "üôÇ";

        // 2. TOGGLE
        function toggleFeatures(cat) {
            const residential = ['Casa', 'Departamento'];
            const commercial = ['Oficina', 'Local'];
            const industrial = ['Industrial'];
            const land = ['Terreno', 'Parcela'];
            ['sec-interior', 'sec-exterior', 'sec-comunidad', 'sec-industrial', 'sec-agricola'].forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            if(residential.includes(cat) || commercial.includes(cat) || cat === 'Parcela') {
                document.getElementById('sec-interior').style.display = 'block';
                if(cat !== 'Oficina' && cat !== 'Local' && cat !== 'Departamento') document.getElementById('sec-exterior').style.display = 'block';
                if(cat === 'Departamento' || cat === 'Oficina') document.getElementById('sec-exterior').style.display = 'block';
            }
            if(['Departamento', 'Oficina', 'Local', 'Casa'].includes(cat)) {
                document.getElementById('sec-comunidad').style.display = 'block';
            }
            if(industrial.includes(cat)) document.getElementById('sec-industrial').style.display = 'block';
            if(land.includes(cat)) document.getElementById('sec-agricola').style.display = 'block';
            const programCard = document.getElementById('program-card');
            
            // Ficha t√©cnica siempre visible, pero adaptada
            programCard.style.display = 'block';
        }

        // 3. PRECIO
        function setCurrencyMode(mode) {
            currentCurrency = mode;
            document.getElementById('pricePrefix').innerText = mode === 'UF' ? 'UF' : (mode === 'CLP' ? '$' : 'US');
            calcPrice();
        }
        function formatNum(e) { let v = e.value.replace(/\D/g,''); if(v) e.value = parseInt(v).toLocaleString('es-CL');
        }
        function calcPrice() {
            const input = document.getElementById('priceInput');
            formatNum(input);
            const raw = parseInt(input.value.replace(/\./g, '')) || 0;
            const disp = document.getElementById('convertedPrice');
            
            if(raw === 0) { disp.innerText = '$ 0'; return; }
            
            if(UF_VALUE === 0 && currentCurrency !== 'USD') {
                disp.innerText = "Sin valor UF";
                return;
            }

            if(currentCurrency === 'UF') disp.innerText = '$ ' + Math.round(raw * UF_VALUE).toLocaleString('es-CL');
            else if(currentCurrency === 'CLP') disp.innerText = 'UF ' + (raw / UF_VALUE).toFixed(2);
            else disp.innerText = 'USD ' + raw;
        }

        // 4. FOTOS
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const gallery = document.getElementById('galleryPreview');

        new Sortable(gallery, { animation: 200, ghostClass: 'ghost', onEnd: updateCovers });
        dropZone.onclick = () => fileInput.click();
        dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('drag-active'); };
        dropZone.ondragleave = () => dropZone.classList.remove('drag-active');
        dropZone.ondrop = (e) => { e.preventDefault(); dropZone.classList.remove('drag-active'); handleFiles(e.dataTransfer.files); };
        fileInput.onchange = (e) => handleFiles(e.target.files);
        function handleFiles(files) {
            Array.from(files).forEach(f => {
                if(f.type.startsWith('image/')) {
                    f.uid = Math.random().toString(36).substr(2,9);
                    uploadedFiles.push(f);
                    const div = document.createElement('div');
                    div.className = 'img-card-wide';
                    div.dataset.uid = f.uid;
                    div.innerHTML = `<div class="badge-cover">PORTADA</div><img src="${URL.createObjectURL(f)}"><button type="button" class="btn-del" onclick="delImg('${f.uid}')"><i class="ph-bold ph-trash"></i></button>`;
                    gallery.appendChild(div);
                    updateCovers();
                }
            });
        }
        window.delImg = (uid) => {
            const idx = uploadedFiles.findIndex(f => f.uid === uid);
            if(idx > -1) uploadedFiles.splice(idx, 1);
            document.querySelector(`[data-uid="${uid}"]`).remove();
            updateCovers();
        }
        function updateCovers() { document.querySelectorAll('.img-card-wide').forEach((el,i) => el.classList.toggle('is-cover', i===0));
        }

        // 5. SUBMIT
        window.validateAndSubmit = async () => {
            document.getElementById('hiddenDesc').value = quill.root.innerHTML;
            const form = document.getElementById('publishForm');
            let valid = true;
            document.querySelectorAll('.input-error').forEach(e => e.classList.remove('input-error'));
            document.querySelectorAll('.error-msg').forEach(e => e.style.display='none');
            form.querySelectorAll('[required]').forEach(el => {
                if(!el.value.trim()) {
                    el.classList.add('input-error');
                    if(el.nextElementSibling?.classList.contains('error-msg')) el.nextElementSibling.style.display='block';
                    else if(el.parentElement.nextElementSibling?.classList.contains('error-msg')) el.parentElement.nextElementSibling.style.display='block';
                    valid = false;
                }
            });
            if(!valid) {
                Swal.fire({ 
                    icon:'error', 
                    title:'Faltan datos', 
                    text:'Revisa los campos en rojo.',
                    customClass:{popup:'swal-modern'} 
                });
                return;
            }

            const formData = new FormData(form);
            formData.delete('imagenes');
            document.querySelectorAll('.img-card-wide').forEach(el => {
                const file = uploadedFiles.find(f => f.uid === el.dataset.uid);
                if(file) formData.append('imagenes', file);
            });
            ['precio','gastos_comunes','contribuciones'].forEach(k=> {
                let v = formData.get(k);
                if(v) formData.set(k, v.replace(/\./g,''));
            });
            Swal.fire({
                html: `
                    <div class="loader-container">
                        <div class="loader-spinner"></div>
                        <h3>Publicando...</h3>
                        <p>Guardando informaci√≥n en la nube</p>
                    </div>
                `,
                showConfirmButton: false,
                allowOutsideClick: false,
                customClass: { popup: 'swal-glass' }
            });
            try {
                const res = await fetch('/api/propiedades/crear', { method:'POST', body:formData });
                const d = await res.json();
                
                if(d.success) {
                    Swal.fire({ icon:'success', title:'¬°Lista!', text:'Propiedad publicada.', confirmButtonText:'Ir al Inventario', customClass:{popup:'swal-modern'} })
                    .then(()=>window.location.href='/admin/propiedades');
                } else {
                    throw new Error(d.message);
                }
            } catch(e) { 
                Swal.fire({ icon:'error', title:'Error', text: e.message, customClass:{popup:'swal-modern'} });
            }
        };

        toggleFeatures('');
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBeMVmY5lCw_TvvUBr6uZh8VrVlWHrU7lg&libraries=places&callback=initMap" async defer></script>
</body>
</html>
<style>
    /* 1. ARREGLAR ICONOS ROTOS (La X y el Check deformes) */
    /* Usamos !important para ganar a cualquier CSS de publish.css o style.css */
    .swal2-icon,
    .swal2-icon div,
    .swal2-icon span,
    .swal2-icon::before,
    .swal2-icon::after {
        box-sizing: content-box !important;
        display: flex !important; /* Asegura alineaci√≥n */
    }

    /* 2. MAQUILLAJE GENERAL (Para que se vea moderno) */
    div:where(.swal2-container) div:where(.swal2-popup) {
        border-radius: 24px !important;
        font-family: 'Inter', system-ui, sans-serif !important;
        padding: 2.5rem !important;
        background: #ffffff !important;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important;
    }

    /* T√≠tulos */
    div:where(.swal2-container) .swal2-title {
        color: #1e293b !important; /* Slate 800 */
        font-size: 1.6rem !important;
        font-weight: 800 !important;
        padding-bottom: 1rem !important;
    }

    /* Texto */
    div:where(.swal2-container) .swal2-html-container {
        color: #64748b !important; /* Slate 500 */
        font-size: 1.05rem !important;
        line-height: 1.6 !important;
    }

    /* Botones */
    div:where(.swal2-container) .swal2-actions {
        margin-top: 1.5rem !important;
        gap: 1rem !important;
    }

    div:where(.swal2-container) .swal2-confirm {
        background-color: #2563EB !important; /* Azul Cygnus */
        border-radius: 12px !important;
        padding: 14px 28px !important;
        font-weight: 600 !important;
        box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.2) !important;
        border: none !important;
    }

    div:where(.swal2-container) .swal2-cancel {
        background-color: #f1f5f9 !important; /* Gris claro */
        color: #64748b !important;
        border-radius: 12px !important;
        padding: 14px 28px !important;
        font-weight: 600 !important;
        border: none !important;
    }

    /* COLORES DE ICONOS (M√°s elegantes) */
    /* √âxito (Verde) */
    .swal2-icon.swal2-success { border-color: #10b981 !important; color: #10b981 !important; }
    .swal2-icon.swal2-success [class^='swal2-success-line'] { background-color: #10b981 !important; }
    .swal2-icon.swal2-success .swal2-success-ring { border: .25em solid rgba(16, 185, 129, 0.2) !important; }
    
    /* Error (Rojo) */
    .swal2-icon.swal2-error { border-color: #ef4444 !important; color: #ef4444 !important; }
    .swal2-icon.swal2-error [class^='swal2-x-mark-line'] { background-color: #ef4444 !important; }

    /* Info (Azul) */
    .swal2-icon.swal2-info { border-color: #3b82f6 !important; color: #3b82f6 !important; }
    .swal2-icon.swal2-info::before { background-color: #3b82f6 !important; } /* A veces usa before */
</style>